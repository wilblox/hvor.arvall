<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>årvoll</title>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</head>

<button id="share-btn">Share</button>

<div id="map-container" style="position:relative; display:inline-block;">
    <img draggable="false" src="HER.png" id="pin" />
    <img draggable="false" src="hvor.årvoll.png" />
</div>

<body>
    <p id="debug">
    </p>
</body>
<style>
    body {
        touch-action: none;
    }

    #pin {
        color: rgb(16, 187, 164);
        position: absolute;
        height: 75px;
        width: auto;
    }

    img {
        width: 100%;
        height: auto;
        user-select: none;
    }
</style>
<script>

let following = true;

function movemouse(e) {
    document.querySelector("#debug").innerHTML = "X: " + Math.round(e.clientX) + " Y: " + Math.round(e.clientY);
    document.querySelector("#pin").style.top = e.clientY + "px";
    document.querySelector("#pin").style.left = e.clientX + "px";
}

let lastMouseEvent = null;

document.addEventListener("pointermove", function(e) {
    lastMouseEvent = e;
    if (following) movemouse(e);
});

document.addEventListener("click", function(e) {
    if (e.target.tagName.toLowerCase() !== "button") {
        following = !following;
        if (following) {
            if (lastMouseEvent) movemouse(lastMouseEvent);
        }
    }
});

  document.getElementById('share-btn').onclick = async function () {
    const map = document.getElementById('map-container');
    const canvas = await html2canvas(map);
    canvas.toBlob(async function (blob) {
        const file = new File([blob], "map.png", { type: "image/png" });
        if (navigator.canShare && navigator.canShare({ files: [file] })) {
            await navigator.share({
                files: [file],
                title: 'Map Screenshot',
                text: 'Check out this map!'
            });
        } else {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'map.png';
            a.click();
            URL.revokeObjectURL(url);
            alert('Sharing not supported. Image downloaded instead. try a different browser.');
        }
    });
};

    document.querySelector("#pin").addEventListener("click", sigmaohio)

</script>

</html>